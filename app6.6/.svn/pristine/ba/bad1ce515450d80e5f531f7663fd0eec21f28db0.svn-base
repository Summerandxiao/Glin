<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
		<meta charset="UTF-8">
		<title>财务服务</title>
		<link rel="stylesheet" href="../css/font-icons.css">
		<link rel="stylesheet" href="../css/iuapmobile.um.css">
		<link rel="stylesheet" href="../css/pages/index.css" />
		<script type="text/javascript" src="../cordova.js"></script>
		
		<script type="text/javascript">
			var onDeviceReady = function() {
				//alert("onDeviceReady");
				console.log("JPushPlugin:Device ready!");
				initiateUI();
			};

			var initiateUI = function() {
				try {
					window.plugins.jPushPlugin.init();
					getRegistrationID();//获取设备id
					if (device.platform != "Android") {
						window.plugins.jPushPlugin.setDebugModeFromIos();
						window.plugins.jPushPlugin.setApplicationIconBadgeNumber(0);
					} else {//ios
						window.plugins.jPushPlugin.setDebugMode(true);
						window.plugins.jPushPlugin.setStatisticsOpen(true);
					}
				} catch (exception) {
					console.log(exception);
				}
				$("#setTagWithAliasButton").click(function(ev) {
					try {
						var tag1 = $("#tagText1").attr("value");
						var tag2 = $("#tagText2").attr("value");
						var tag3 = $("#tagText3").attr("value");
						var alias = $("#aliasText").attr("value");
						var tags = [];

						if (tag1 != "") {
							tags.push(tag1);
						}
						if (tag2 != "") {
							tags.push(tag2);
						}
						if (tag3 != "") {
							tags.push(tag3);
						}
						window.plugins.jPushPlugin.setTagsWithAlias(tags, alias);
					} catch (exception) {
						console.log(exception);
					}
				})
			};

			var getRegistrationID = function() {
				window.plugins.jPushPlugin.getRegistrationID(onGetRegistrationID);
			};

			var onGetRegistrationID = function(data) {
				try {
					console.log("JPushPlugin:registrationID is " + data);
					//alert("registrationID==" + data);
					if (data.length == 0) {
						var t1 = window.setTimeout(getRegistrationID, 1000);
					}
					$("#registrationId").html(data);
					$("#registration_id").val(data);
					//设置要接受通知的设备的registration_id值
					summer.setStorage("registration_id", data);
				} catch (exception) {
					console.log(exception);
				}
			};

			var onTagsWithAlias = function(event) {
				try {
					console.log("onTagsWithAlias");
					var result = "result code:" + event.resultCode + " ";
					result += "tags:" + event.tags + " ";
					result += "alias:" + event.alias + " ";
					$("#tagAliasResult").html(result);
				} catch (exception) {
					console.log(exception)
				}
			};

			var onOpenNotification = function(event) {
				try {
					var alertContent;
					var msgId = "";
					if (device.platform == "Android") {
						alertContent = event.alert;
						msgId = event.extras.newsid;
					} else {
						alertContent = event.aps.alert;
						msgId = event.aps.extras.newsid;
					}
					//alert("新通知:" + alertContent);
					summer.setStorage("alertContent", alertContent);
					summer.setStorage("msgId", msgId);//msgId 用summer传参数会自动改数字导致无法更新具体msgId为已读 用 存到localStorage中解决  
					setTimeout("openMethod()",300);
					//加setTimeout因为报错 很抱歉程序出现异常 即将退出
					
					
				} catch (exception) {
					console.log("JPushPlugin:onOpenNotification" + exception);
				}
			};

			var onReceiveNotification = function(event) {
				try {
					var alertContent;
					if (device.platform == "Android") {
						alertContent = event.alert;
					} else {
						alertContent = event.aps.alert;
					}
					$("#notificationResult").html(alertContent);
				} catch (exception) {
					console.log(exception)
				}
			};

			var onReceiveMessage = function(event) {
				try {
					var message;
					if (device.platform == "Android") {
						message = event.message;
					} else {
						message = event.content;
					}
					$("#messageResult").html(message);
				} catch (exception) {
					console.log("JPushPlugin:onReceiveMessage-->" + exception);
				}
			};
			
			var openMethod = function(){
				summer.openWin({
					id : 'message',
					url : 'html/message.html',
					pageParam : {
						fromPage:'login',
						title : '信息'
					}
				});
			}
//注释掉推送消息通知的功能
//			document.addEventListener("jpush.setTagsWithAlias", onTagsWithAlias, false);
//			document.addEventListener("deviceready", onDeviceReady, false);
//			document.addEventListener("jpush.openNotification", onOpenNotification, false);
//			document.addEventListener("jpush.receiveNotification", onReceiveNotification, false);
//			document.addEventListener("jpush.receiveMessage", onReceiveMessage, false);
			//document.addEventListener("click", onClick,false);
		</script>
	</head>
	<body>
		
		<div id="login-win" class="um-win" >
		<div style="background: #00a1ea;width: 100%;height: 50px;text-align: center;font-size: 16px;color: #fff;line-height: 50px">用户登录</div>
			<div id="longin-content" class="um-content">
				<div id="login-form" class="m10 p15">
					<div style="text-align: center;">
					<img id="img_my" src="../img/logintop.png" width="140px" style="padding-top: 65px;padding-bottom: 40px;" alt="" class="um-rounded um-img-responsive" >
					</div>
					<div id="errorInfo"></div>
					<div class="um-input-group login-input">
						<span class="ti-user"></span>
						<input id="user" type="text" class="form-control" placeholder="请输入用户名">
					</div>
					<div class="um-input-group login-input">
						<span class="ti-lock"></span>
						<input id="password" type="password" class="form-control" placeholder="请输入密码">
					</div>
					<div class="um-box">
						<div class="um-bf1 p5">
							<label class="um-check-inline">
								<input id="isSavePass" name="um-checkbox-inline" type="checkbox" value="记住密码" checked>
								<span class="um-icon-checkbox um-css3-vc"></span> <span class="um-black ml5">记住密码</span> </label>
						</div>
						<div class="um-bf1 p5">
							<label class="um-check-inline">
								<input id="isAutoLogin" name="um-checkbox-inline" type="checkbox" value="自动登录" checked>
								<span class="um-icon-checkbox um-css3-vc"></span> <span class="um-black ml5">自动登录</span> </label>
						</div>
					</div>
					<div class="um-row m5">
						<button class="um-btn um-no-brs" id="login">
							登录
						</button>
					</div>
					<div class="um-input-group login-input" style="display: none">
						<span class="" style="padding-top: 8px;">设备ID:&nbsp;</span><!-- readonly="true" -->
						<input  type="text" id="registration_id"  style="border: 0px;font-size: 17px;padding-top: 8px;width: 80%;">
					</div>
				</div>
			</div>
            <div class="um-box-justify p15" id="netConfigMsg">
            	<a href="#" id="netConfigSet">设置网络连接</a>
        	</div>
		</div>
	</body>
	<script src="../js/summer.js" ></script>
	<script src="../js/jquery.min.js" ></script>
	<script src="../js/Frameworks/iuapmobile.frameworks.ui.js" ></script>
	<script src="../js/login.js" ></script> 
	<!-- <script src="../js/login_debug.js" ></script>-->
</html>